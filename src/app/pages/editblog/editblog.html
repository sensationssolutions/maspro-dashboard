<div class="page-wrapper">
  <div class="page-content">
    <div class="container-xxl mt-3">
      <div class="row justify-content-center">
        <div class="col-md-12 col-lg-12">
          <div class="card mt-3">
            <div class="card-header">
              <h4 class="card-title mb-0">Edit Blog</h4>
            </div>
            <div class="card-body">
              <div *ngIf="loadingData" class="text-center py-4">
                <div class="spinner-border" role="status">
                  <span class="visually-hidden">Loading...</span>
                </div>
                <p class="mt-2">Loading blog data...</p>
              </div>

              <form *ngIf="!loadingData" (ngSubmit)="updateBlog()">
                <div class="row">
                  <div class="col-md-6">
                    <div class="mb-3">
                      <label class="form-label">Title <span class="text-danger">*</span></label>
                      <input
                        type="text"
                        class="form-control"
                        [(ngModel)]="formData.title"
                        name="title"
                        placeholder="Enter blog title"
                        required
                      />
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="mb-3">
                      <label class="form-label">Date <span class="text-danger">*</span></label>
                      <input
                        type="date"
                        class="form-control"
                        [(ngModel)]="formData.date"
                        name="date"
                        required
                      />
                    </div>
                  </div>
                </div>

                <div class="mb-3">
                  <label class="form-label">Description <span class="text-danger">*</span></label>
                  <ngx-editor-menu [editor]="descriptionEditor" [toolbar]="toolbar"></ngx-editor-menu>
                  <ngx-editor
                    [editor]="descriptionEditor"
                    [(ngModel)]="formData.description"
                    name="description"
                    placeholder="Enter blog description..."
                    required
                  ></ngx-editor>
                </div>

                <!-- Existing Images -->
                <div class="mb-3" *ngIf="existingImages.length > 0">
                  <label class="form-label">Existing Images</label>
                  <div class="row">
                    <div class="col-md-3 mb-2" *ngFor="let image of existingImages; let i = index">
                      <div class="position-relative">
                        <img
                           [src]="environment.assetsUrl + 'storage/' + image.image_url"
                          alt="Existing image"
                          class="img-fluid rounded"
                          style="width: 100%; height: 150px; object-fit: cover;"
                        />
                        <button
                          type="button"
                          class="btn btn-sm btn-danger position-absolute top-0 end-0 m-1"
                          (click)="removeExistingImage(i)"
                        >
                          <i class="las la-times"></i>
                        </button>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="mb-3">
                  <label class="form-label">Add New Images <small class="text-muted">(Up to 4 total including existing, 2MB each)</small></label>
                  <input
                    type="file"
                    class="form-control"
                    (change)="onImagesSelected($event)"
                    multiple
                    accept="image/*"
                    id="imageUpload"
                    [disabled]="(existingImages.length + selectedImages.length) >= 4"
                  />
                  <div class="form-text">
                    You can add up to {{ 4 - existingImages.length - selectedImages.length }} more images.
                    Total images: {{ existingImages.length + selectedImages.length }}/4
                  </div>
                </div>

                <!-- New Image Previews -->
                <div class="mb-3" *ngIf="imagePreviews.length > 0">
                  <label class="form-label">New Image Previews</label>
                  <div class="row">
                    <div class="col-md-3 mb-2" *ngFor="let preview of imagePreviews; let i = index">
                      <div class="position-relative">
                        <img
                          [src]="preview"
                          alt="Preview"
                          class="img-fluid rounded"
                          style="width: 100%; height: 150px; object-fit: cover;"
                        />
                        <button
                          type="button"
                          class="btn btn-sm btn-danger position-absolute top-0 end-0 m-1"
                          (click)="removeImage(i)"
                        >
                          <i class="las la-times"></i>
                        </button>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="mb-3">
                  <div class="form-check">
                    <input
                      class="form-check-input"
                      type="checkbox"
                      [(ngModel)]="formData.status"
                      name="status"
                      id="statusCheck"
                    />
                    <label class="form-check-label" for="statusCheck">
                      Active
                    </label>
                  </div>
                </div>

                <div class="d-flex gap-2">
                  <button
                    type="submit"
                    class="btn btn-blue"
                    [disabled]="loading"
                  >
                    <span *ngIf="loading" class="spinner-border spinner-border-sm me-2"></span>
                    {{ loading ? 'Updating...' : 'Update Blog' }}
                  </button>
                  <a [routerLink]="['/blogs']" class="btn btn-secondary">
                    Cancel
                  </a>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
